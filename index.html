<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz IBGE Animado</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    margin: 20px;
    background-color: #f4f4f9;
    color: #333;
    max-width: 800px; /* Limita a largura em telas grandes */
    margin-left: auto;
    margin-right: auto;
  }
  .question p {
    font-size: 1.2em; /* Aumenta o tamanho da fonte da pergunta */
    font-weight: bold;
    margin-bottom: 20px;
  }
  button {
    margin: 5px;
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    background-color: #3498db;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: transform 0.2s, background-color 0.3s, box-shadow 0.3s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  button:hover {
    background-color: #2980b9;
    transform: scale(1.05);
  }
  button:active {
    background-color: #1abc9c;
    transform: scale(0.95);
  }
  .correct {
    background-color: #2ecc71; /* Verde */
  }
  .incorrect {
    background-color: #e74c3c; /* Vermelho */
  }
  button.disabled {
    pointer-events: none;
    opacity: 0.7;
  }
  #progress-container {
    width: 100%;
    background-color: #e0e0e0;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
  }
  #progress-bar {
    width: 0%; /* Inicia em 0 */
    height: 22px;
    background-color: #4caf50; /* Verde progresso */
    border-radius: 8px;
    text-align: center;
    line-height: 22px;
    color: white;
    font-weight: bold;
    transition: width 0.4s ease-in-out;
  }

  /* --- Estilos para Mobile --- */
  @media (max-width: 600px) {
    body {
      margin: 10px; /* Margem menor em telas pequenas */
      font-size: 16px;
    }
    .question button {
      display: block; /* Faz os bot√µes empilharem */
      width: 100%;    /* Ocupam toda a largura */
      margin: 8px 0;  /* Ajusta a margem vertical */
      padding: 15px;  /* Aumenta a √°rea de toque */
    }
  }
</style>
</head>
<body>
<h1>Simulado IBGE ‚Äì N√≠vel M√©dio</h1>
<div id="progress-container">
  <div id="progress-bar"></div>
</div>
<div id="quiz"></div>

<script>
let questions = [];
let current = 0;
let score = 0;

// Cria um contexto de √°udio para os sons de feedback
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function showQuestion(){
  const q = questions[current];
  const quizDiv = document.getElementById("quiz");
  let html = `<div class="question"><p>${current+1}. ${q.q}</p>`;
  q.options.forEach((opt,i)=>{
    // Usamos atributos data-* para armazenar o √≠ndice da op√ß√£o
    html += `<button data-choice="${i}">${String.fromCharCode(65+i)}) ${opt}</button>`;
  });
  html += `</div>`;
  quizDiv.innerHTML = html;

  // Atualiza a barra de progresso
  updateProgressBar();

  // Adiciona os event listeners aos novos bot√µes
  quizDiv.querySelectorAll('button').forEach(button => {
    button.addEventListener('click', (event) => {
      checkAnswer(parseInt(event.target.dataset.choice));
    });
  });
}

function checkAnswer(choice){
  const q = questions[current];
  const buttons = document.querySelectorAll('#quiz button');

  // Desabilita todos os bot√µes para evitar cliques m√∫ltiplos
  buttons.forEach(button => button.classList.add('disabled'));

  if(choice === questions[current].answer){
    score++;
    playFeedbackSound(true); // Toca som de acerto
  } else {
    playFeedbackSound(false); // Toca som de erro
  }

  // Adiciona classes para feedback visual
  buttons[q.answer].classList.add('correct');
  if (choice !== q.answer) {
    buttons[choice].classList.add('incorrect');
  }

  // Avan√ßa para a pr√≥xima pergunta ou mostra o resultado final ap√≥s um intervalo
  setTimeout(() => {
    current++;
    if(current < questions.length){
      showQuestion();
    } else {
      showResults();
    }
  }, 1500); // Espera 1.5 segundos antes de continuar
}

function playFeedbackSound(isCorrect) {
  // O AudioContext pode n√£o ser suportado em navegadores muito antigos
  if (!audioCtx) return;

  const oscillator = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();

  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);

  if (isCorrect) {
    // Som de acerto: tom agudo e curto
    oscillator.type = 'sine'; // Onda suave
    oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime); // Volume
    oscillator.stop(audioCtx.currentTime + 0.15); // Dura√ß√£o
  } else {
    // Som de erro: tom grave e mais "duro"
    oscillator.type = 'square'; // Onda mais "quadrada"
    oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
    oscillator.stop(audioCtx.currentTime + 0.3);
  }
  oscillator.start();
}

function updateProgressBar() {
  const progress = ((current + 1) / questions.length) * 100;
  const progressBar = document.getElementById('progress-bar');
  if (progressBar) {
    progressBar.style.width = progress + '%';
    progressBar.textContent = `${current + 1} / ${questions.length}`;
  }
}

function showResults() {
  const quizDiv = document.getElementById("quiz");
  quizDiv.innerHTML =
    `<h2>Fim do simulado!</h2>
     <p>Pontua√ß√£o: ${score}/${questions.length}</p>
     <p>M√©dia final: ${(score/questions.length*10).toFixed(1)}</p>
     <button onclick="restartQuiz()">Reiniciar Quiz</button>`;
  // Opcional: Esconde a barra de progresso na tela de resultados
  document.getElementById('progress-container').style.display = 'none';
}

function restartQuiz() {
  current = 0;
  score = 0;
  // Mostra a barra de progresso novamente
  document.getElementById('progress-container').style.display = 'block';
  // Embaralha as perguntas para um novo desafio
  shuffleArray(questions);
  showQuestion();
}

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// Fun√ß√£o principal que inicia o quiz
async function startQuiz() {
  try {
    // Garante que a barra de progresso esteja vis√≠vel ao iniciar
    document.getElementById('progress-container').style.display = 'block';
    const response = await fetch('questions.json'); // Carrega o arquivo JSON
    questions = await response.json(); // Converte a resposta em um objeto JavaScript
    // Embaralha as perguntas ao carregar o quiz pela primeira vez
    shuffleArray(questions);
    showQuestion(); // Mostra a primeira pergunta
  } catch (error) {
    document.getElementById("quiz").innerHTML = "<p>Erro ao carregar as perguntas. Tente novamente mais tarde.</p>";
    console.error("Falha ao carregar o quiz:", error);
  }
}

startQuiz(); // Inicia o processo
</script>
</body>
</html>
